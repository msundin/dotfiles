#!/bin/bash

# Function to close all running applications gracefully
close_all_apps() {
  # Get a list of running applications
  apps=$(osascript -e 'tell application "System Events" to get the name of every application process whose background only is false')

  # Iterate through the list and close each application
  while IFS= read -r app; do
    app=$(echo "$app" | xargs)  # Remove leading/trailing spaces
    app_lower=$(echo "$app" | tr '[:upper:]' '[:lower:]')
    if [ "$app_lower" != "finder" ] && [ "$app_lower" != "dock" ] && [ "$app_lower" != "systemuiserver" ] && [ "$app_lower" != "alacritty" ]; then
      echo "Closing $app..."
      osascript -e "tell application \"$app\" to quit"
      # Give each application a moment to close
      sleep 2
    fi
  done <<< "$(echo "$apps" | tr ',' '\n')"
}

# Function to forcefully terminate any remaining applications
force_quit_apps() {
  apps=$(osascript -e 'tell application "System Events" to get the name of every application process whose background only is false')

  while IFS= read -r app; do
    app=$(echo "$app" | xargs)  # Remove leading/trailing spaces
    app_lower=$(echo "$app" | tr '[:upper:]' '[:lower:]')
    if [ "$app_lower" != "finder" ] && [ "$app_lower" != "dock" ] && [ "$app_lower" != "systemuiserver" ] && [ "$app_lower" != "alacritty" ] && [ "$app_lower" != "brave browser" ]; then
      echo "Force quitting $app..."
      pkill -f "$app"
    fi
  done <<< "$(echo "$apps" | tr ',' '\n')"
}

# Close all running applications gracefully
close_all_apps

# Commented out for now
# Force quit any remaining applications
# force_quit_apps
